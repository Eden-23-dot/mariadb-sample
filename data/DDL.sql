DROP DATABASE IF EXISTS BOOKSTORE;

CREATE DATABASE BOOKSTORE;
USE BOOKSTORE;

DROP TABLE IF EXISTS BOOK_AUTHOR;
DROP TABLE IF EXISTS AUTHOR;
DROP TABLE IF EXISTS ORDER_DETAIL;
DROP TABLE IF EXISTS ORDERS;
DROP TABLE IF EXISTS BOOK;
DROP TABLE IF EXISTS CATEGORY;
DROP TABLE IF EXISTS ADDRESS;
DROP TABLE IF EXISTS CUSTOMER;

CREATE TABLE CUSTOMER(
  ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
  FIRST_NAME VARCHAR(100) NOT NULL,
  LAST_NAME  VARCHAR(100) NOT NULL,
  DOB DATE NOT NULL,
  EMAIL VARCHAR(100)  NOT NULL,
  IS_IN_EMAIL_LIST BOOLEAN DEFAULT TRUE,
  PHONE VARCHAR(50)
);


CREATE TABLE ADDRESS(
  ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
  UNIT VARCHAR(10),
  STREET_NO VARCHAR(10) NOT NULL,
  STREET VARCHAR(100) NOT NULL,
  SUBURB VARCHAR(100) NOT NULL,
  POSTCODE VARCHAR(10) NOT NULL,
  STATE VARCHAR(50) NOT NULL,
  COUNTRY VARCHAR(100) NOT NULL,
  IS_DEFAULT BOOLEAN DEFAULT FALSE,
  CUSTOMER_ID INT NOT NULL,  
  FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(ID) 
);

CREATE TABLE CATEGORY(
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    DESCRIPTION VARCHAR(500) NOT NULL
);

CREATE TABLE BOOK(
  ISBN VARCHAR(50) PRIMARY KEY NOT NULL,
  TITLE VARCHAR(300) NOT NULL,
  SYNOPSIS VARCHAR(3000) NOT NULL,
  STOCK INT NOT NULL,
  UNIT_PRICE DOUBLE(10,2) NOT NULL,
  CATEGORY_ID INT NOT NULL,
  FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY(ID)
);

CREATE TABLE ORDERS(
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    PURCHASED_ON DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    TOTAL DOUBLE NOT NULL,
    STATUS VARCHAR(100) NOT NULL,
    REASON VARCHAR(3000),
    CUSTOMER_ID INT NOT NULL
);

ALTER TABLE ORDERS
ADD FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (ID);

CREATE TABLE ORDER_DETAIL(
  ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
  UNIT_PRICE DOUBLE(10,2),
  QUANTITY INT NOT NULL,
  ISBN VARCHAR(50) NOT NULL,
  ORDER_ID INT NOT NULL
);

ALTER TABLE ORDER_DETAIL
ADD FOREIGN KEY (ISBN) REFERENCES BOOK (ISBN);

ALTER TABLE ORDER_DETAIL
ADD  FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ID);

CREATE TABLE AUTHOR(
  ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
  FIRST_NAME VARCHAR(100) NOT NULL,
  LAST_NAME VARCHAR(100) NOT NULL,
  NATIONALITY VARCHAR(100)
);

CREATE TABLE BOOK_AUTHOR(
  ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
  ISBN VARCHAR(50) NOT NULL,
  AUTHOR_ID INT NOT NULL
);

ALTER TABLE BOOK_AUTHOR
ADD FOREIGN KEY (ISBN) REFERENCES BOOK (ISBN);

ALTER TABLE BOOK_AUTHOR
ADD  FOREIGN KEY (AUTHOR_ID) REFERENCES AUTHOR (ID);
